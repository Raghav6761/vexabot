import{a as u}from"./chunk-EAL2B4IN.js";import{b as l}from"./chunk-OMQHCXRE.js";import{$ as a,Ac as o,X as i,ea as n,lb as s}from"./chunk-LBNGVE6L.js";var h=class r{constructor(t){this.http=t;console.log("api url : ",this.API_URL),this.checkInitialAuth()}API_URL=u.apiUrl;isAuthenticated=s(!1);user=s(null);user_roles=s(null);authStatus=o(()=>this.isAuthenticated());currentUser=o(()=>this.user());currentUserRoles=o(()=>this.user_roles());login(t){return console.log("login : ",t),this.http.post(`${this.API_URL}/auth/login`,t)}otpVerify(t){return console.log("OTP Verify : ",t),this.http.post(`${this.API_URL}/auth/verify-otp`,t).pipe(i(e=>this.handleAuthSuccess(e)))}signup(t){return console.log("sign up : ",t),this.http.post(`${this.API_URL}/auth/signup`,t)}forgotPassword(t){return this.http.post(`${this.API_URL}/auth/forgot-password`,t)}resetPassword(t,e){return this.http.post(`${this.API_URL}/auth/reset-password`,{access_token:t,newPassword:e})}logout(){localStorage.removeItem("access_token"),localStorage.removeItem("current_organization_id"),localStorage.removeItem("email"),localStorage.removeItem("is_super_admin"),localStorage.removeItem("access_token"),this.isAuthenticated.set(!1),this.user.set(null)}handleAuthSuccess(t){localStorage.setItem("access_token",t.token.access_token),this.isAuthenticated.set(!0),console.log("response  : ",t),this.isAuthenticated.set(!0),this.user.set(t.user_data),this.user_roles.set(t.user_roles),console.log("user : ",this.user()),console.log("user roles : ",this.user_roles())}checkInitialAuth(){let t=localStorage.getItem("access_token");t&&this.validateToken(t).subscribe({next:e=>{this.isAuthenticated.set(!0),this.user.set(e)},error:()=>this.logout()})}validateToken(t){return this.http.get(`${this.API_URL}/auth/validate-token`)}static \u0275fac=function(e){return new(e||r)(n(l))};static \u0275prov=a({token:r,factory:r.\u0275fac,providedIn:"root"})};export{h as a};
