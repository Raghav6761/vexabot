import{a as m}from"./chunk-MDC4N2GR.js";import{b as z}from"./chunk-OMQHCXRE.js";import{$ as h,Ac as a,X as n,a as g,b as l,ea as d,lb as s}from"./chunk-LBNGVE6L.js";var O=class p{constructor(t){this.http=t;this.loadOrganizations(),this.loadProjects(),this.loadGroups(),this.loadUsers()}API_URL=m.apiUrl;currentOrganizationSignal=s("");organizationsSignal=s([]);projectsSignal=s([]);usersSignal=s({users:[],total:0});groupsSignal=s([]);currentOrganization=a(()=>this.currentOrganizationSignal());organizations=a(()=>this.organizationsSignal());projects=a(()=>this.projectsSignal());users=a(()=>this.usersSignal());groups=a(()=>this.groupsSignal());setCurrentOrganization(t){if(!t&&!localStorage.getItem("current_organization_id")){let r=this.organizations();console.log("id : ",t),this.currentOrganizationSignal.set(r[0].id),console.log("current_organization_id could not match",r[0].id),localStorage.setItem("current_organization_id",r[0].id);return}if(!t&&localStorage.getItem("current_organization_id")){this.currentOrganizationSignal.set(localStorage.getItem("current_organization_id")),console.log("current_organization_id could not match setting it to localStorage item");return}if(t&&this.organizations().some(r=>r.id===t))console.log("organization id matched"),this.currentOrganizationSignal.set(t),localStorage.setItem("current_organization_id",t);else{let r=this.organizations();localStorage.getItem("current_organization_id")?(this.currentOrganizationSignal.set(localStorage.getItem("current_organization_id")),console.log("current_organization_id could not match setting it to localStorage item")):(this.currentOrganizationSignal.set(r[0].id),console.log("current_organization_id could not match setting it to top item"),localStorage.setItem("current_organization_id",r[0].id))}}loadOrganizations(){this.http.get(this.API_URL+"/organizations").subscribe({next:t=>{console.log("organizations fetched : ",t),this.organizationsSignal.set(t)},error:t=>console.error("Error loading organizations : ",t)})}addOrganization(t,r){let i={name:t,description:r};return console.log("add org : ",i),this.http.post(this.API_URL+"/organizations",i).pipe(n(o=>{this.organizationsSignal.update(e=>[...e,o])}))}deleteOrganization(t){return this.http.delete(`${this.API_URL+"/organizations"}/${t}`).pipe(n(()=>{this.organizationsSignal.update(r=>r.filter(i=>i.id!==t))}))}updateOrganization(t,r){return this.http.patch(`${this.API_URL+"organizations"}/${t}`,r).pipe(n(i=>{this.organizationsSignal.update(o=>o.map(e=>e.id===t?i:e))}))}loadProjects(){console.log("current organization : ",this.currentOrganization());let t=this.currentOrganization();this.http.get(this.API_URL+`/organizations/${t}/projects`).subscribe({next:r=>{console.log("projects fetched : ",r),this.projectsSignal.set(r)},error:r=>console.error("Error loading projects : ",r)})}addProject(t,r,i,o){let e={name:t,admin:r,organization:i,description:o};return console.log("add project : ",e),this.http.post(this.API_URL+`/organizations/${i}/projects`,e)}deleteProject(t){let r=this.currentOrganization();return this.http.delete(this.API_URL+`/organizations/${r}/projects/${t}`).pipe(n(()=>{this.projectsSignal.update(i=>i.filter(o=>o.id!==t))}))}updateProject(t,r){return this.http.patch(`${this.API_URL+"projects"}/${t}`,r).pipe(n(i=>{this.projectsSignal.update(o=>o.map(e=>e.id===t?i:e))}))}loadUsers(){this.http.get(this.API_URL+"/users/").subscribe({next:t=>{console.log("users fetched : ",t),this.usersSignal.set(t)},error:t=>console.error("Error loading users : ",t)})}addUser(t,r,i,o,e,b){let u={email:t,username:r,is_active:i,is_super_admin:o,client_id:e,password:b};return console.log("add user : ",u),this.http.post(this.API_URL+"/users",u).pipe(n(S=>{this.usersSignal.update(c=>l(g({},c),{users:[...c.users,S],total:c.total+1}))}))}deleteUser(t){return this.http.delete(`${this.API_URL+"/users"}/${t}`).pipe(n(()=>{this.usersSignal.update(r=>l(g({},r),{users:r.users.filter(i=>i.id!==t)}))}))}updateUser(t,r){return this.http.patch(`${this.API_URL+"/users"}/${t}`,r).pipe(n(i=>{this.usersSignal.update(o=>l(g({},o),{users:o.users.map(e=>e.id===t?i:e)}))}))}loadGroups(){this.http.get(this.API_URL+"/user-groups").subscribe({next:t=>{console.log("groups fetched : ",t),this.groupsSignal.set(t)},error:t=>console.error("Error loading groups : ",t)})}getUsersByOrganization(t){return this.http.get(`${this.API_URL}/orgnizations/${t}/groups`)}createGroup(t,r){let i={name:t,description:r};return console.log("add group : ",i),this.http.post(this.API_URL+"/user-groups",i).pipe(n(o=>{this.groupsSignal.update(e=>[...e,o])}))}deleteGroup(t){return this.http.delete(`${this.API_URL+"/user-groups"}/${t}`).pipe(n(()=>{this.groupsSignal.update(r=>r.filter(i=>i.id!==t))}))}updateGroup(t,r){return this.http.patch(`${this.API_URL+"groups"}/${t}`,r).pipe(n(i=>{this.groupsSignal.update(o=>o.map(e=>e.id===t?i:e))}))}static \u0275fac=function(r){return new(r||p)(d(z))};static \u0275prov=h({token:p,factory:p.\u0275fac,providedIn:"root"})};export{O as a};
