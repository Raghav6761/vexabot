import{a as B}from"./chunk-MDC4N2GR.js";import{b as D,f as J,g as Q,h as U,i as W,j as z,o as G}from"./chunk-PXIP7OAW.js";import{a as v,b as H}from"./chunk-OMQHCXRE.js";import{k as j,l as F,m as V,o as q}from"./chunk-FHMWGGDF.js";import{$ as _,Gb as o,Hb as l,Ib as w,Kb as O,Nb as P,Tb as S,Ub as I,Vb as k,_b as p,ab as c,ac as A,bb as x,bc as N,cc as E,dc as T,ea as y,fc as L,hc as R,ic as C,ka as M,sb as m,t as b,ta as f,ua as h,xb as d}from"./chunk-LBNGVE6L.js";var u=class s{constructor(e){this.http=e}API_URL=B.apiUrl+"/chat";sendMessage(e,t,n="llama"){let r=new v({"Content-Type":"application/json"}),i={messages:e,chat_model:n};return t&&(i.chat_id=t),console.log("req body : ",i),this.http.post(this.API_URL,i,{headers:r})}streamMessage(e,t,n="llama"){let r=new v({"Content-Type":"application/json",Accept:"text/event-stream"}),i={messages:e,chat_model:n};return t&&(i.chat_id=t),console.log("in the stream message : ",i),this.http.post(this.API_URL,i,{headers:r,responseType:"text",observe:"response"}).pipe(b(a=>(a.body?.split(`
`).filter(g=>g.trim())||[]).map(g=>{try{return JSON.parse(g)}catch{return console.error("Error parsing chunk:",g),null}}).filter(Boolean)))}static \u0275fac=function(t){return new(t||s)(y(H))};static \u0275prov=_({token:s,factory:s.\u0275fac,providedIn:"root"})};var $=["messagesContainer"],ee=s=>({"button-disabled":s}),te=(s,e)=>({"user-message-wrapper":s,"assistant-message-wrapper":e}),ne=(s,e)=>({"user-message":s,"assistant-message":e});function se(s,e){s&1&&(o(0,"div",15),p(1," AI "),l())}function ae(s,e){s&1&&(o(0,"div",16),p(1," You "),l())}function ie(s,e){if(s&1&&(o(0,"div",11),m(1,se,2,0,"div",12),o(2,"div",13),p(3),l(),m(4,ae,2,0,"div",14),l()),s&2){let t=e.$implicit;d("ngClass",C(5,te,t.role==="user",t.role==="assistant")),c(),d("ngIf",t.role==="assistant"),c(),d("ngClass",C(8,ne,t.role==="user",t.role==="assistant")),c(),A(" ",t.content," "),c(),d("ngIf",t.role==="user")}}function oe(s,e){s&1&&(o(0,"div",17)(1,"div",15),p(2," AI "),l(),o(3,"div",18)(4,"div",19),w(5,"div",20)(6,"div",20)(7,"div",20),l()()())}var Y=class s{constructor(e){this.chatService=e}messages=[{role:"assistant",content:"Hello! How can I help you today?"}];inputMessage="";isLoading=!1;currentChatId=void 0;modelName="llama";messagesContainer;ngOnInit(){}ngAfterViewChecked(){this.scrollToBottom()}scrollToBottom(){try{this.messagesContainer.nativeElement.scrollTop=this.messagesContainer.nativeElement.scrollHeight}catch{}}handleStreamingResponse(e){console.log("Response type:",typeof e),console.log("Is array:",Array.isArray(e));let t="",n=this.currentChatId;Array.isArray(e)&&e.length>0&&typeof e[0]=="string"&&e[0].split(`
`).forEach(i=>{if(i.trim())try{let a;try{a=JSON.parse(i)}catch{let g=i.replace(/\\"/g,'"').replace(/\\\\/g,"\\");a=JSON.parse(g)}a.message&&a.message.content&&(t+=a.message.content),a.chat_id&&(n=a.chat_id)}catch(a){console.error("Error processing JSON line:",a),console.error("Problematic line:",i)}}),n&&(this.currentChatId=n),t?this.addAssistantMessage(t):(console.warn("No content found in response"),Array.isArray(e)&&e.length>0&&typeof e[0]=="string"&&this.addAssistantMessage("Received response but couldn't parse it properly."))}handleSubmit(){if(this.inputMessage.trim()==="")return;this.messages.push({role:"user",content:this.inputMessage}),console.log("on submitting : ",this.messages);let e=this.inputMessage;this.inputMessage="",this.isLoading=!0;let t=this.messages.map(n=>({role:n.role,content:n.content}));this.chatService.streamMessage(t,this.currentChatId,this.modelName).subscribe({next:n=>{console.log("chunks from the backend : ",n),this.handleStreamingResponse(n),this.isLoading=!1},error:n=>{console.error("Error sending message:",n),this.addAssistantMessage("Sorry, there was an error processing your request."),this.isLoading=!1}})}addAssistantMessage(e){console.log("content to update in the frontend : ",e),this.messages.push({role:"assistant",content:e})}static \u0275fac=function(t){return new(t||s)(x(u))};static \u0275cmp=M({type:s,selectors:[["app-chat"]],viewQuery:function(t,n){if(t&1&&S($,5),t&2){let r;I(r=k())&&(n.messagesContainer=r.first)}},standalone:!0,features:[L],decls:12,vars:7,consts:[["messagesContainer",""],[1,"chat-container"],[1,"main-area"],[1,"messages-container"],["class","message-wrapper",3,"ngClass",4,"ngFor","ngForOf"],["class","message-wrapper assistant-message-wrapper",4,"ngIf"],[1,"input-container"],[3,"ngSubmit"],[1,"input-form"],["type","text","name","inputMessage","placeholder","Type your message here...",1,"message-input",3,"ngModelChange","ngModel"],["type","submit",1,"send-button",3,"disabled","ngClass"],[1,"message-wrapper",3,"ngClass"],["class","avatar assistant-avatar",4,"ngIf"],[1,"message",3,"ngClass"],["class","avatar user-avatar",4,"ngIf"],[1,"avatar","assistant-avatar"],[1,"avatar","user-avatar"],[1,"message-wrapper","assistant-message-wrapper"],[1,"message","assistant-message","loading-message"],[1,"loading-dots"],[1,"dot"]],template:function(t,n){if(t&1){let r=O();o(0,"div",1)(1,"div",2)(2,"div",3,0),m(4,ie,5,11,"div",4)(5,oe,8,0,"div",5),l(),o(6,"div",6)(7,"form",7),P("ngSubmit",function(){return f(r),h(n.handleSubmit())}),o(8,"div",8)(9,"input",9),T("ngModelChange",function(a){return f(r),E(n.inputMessage,a)||(n.inputMessage=a),h(a)}),l(),o(10,"button",10),p(11," Send "),l()()()()()()}t&2&&(c(4),d("ngForOf",n.messages),c(),d("ngIf",n.isLoading),c(4),N("ngModel",n.inputMessage),c(),d("disabled",n.isLoading||n.inputMessage.trim()==="")("ngClass",R(5,ee,n.isLoading||n.inputMessage.trim()==="")))},dependencies:[q,j,F,V,G,z,D,J,Q,W,U],styles:["[_nghost-%COMP%]{display:block;height:90vh;width:100%}.chat-container[_ngcontent-%COMP%]{display:flex;height:100%;color:#fff}.main-area[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;width:100%}.messages-container[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:16px;display:flex;flex-direction:column;gap:16px}.message-wrapper[_ngcontent-%COMP%]{display:flex;max-width:80%}.user-message-wrapper[_ngcontent-%COMP%]{align-self:flex-end;flex-direction:row-reverse}.assistant-message-wrapper[_ngcontent-%COMP%]{align-self:flex-start}.avatar[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700}.assistant-avatar[_ngcontent-%COMP%]{background-color:#0bc5ea;margin-right:8px}.user-avatar[_ngcontent-%COMP%]{background-color:#3a3a3a;margin-left:8px}.message[_ngcontent-%COMP%]{padding:12px 16px;border-radius:12px;word-break:break-word;line-height:1.5}.user-message[_ngcontent-%COMP%]{background-color:#2b6cb0;border-bottom-right-radius:0}.assistant-message[_ngcontent-%COMP%]{background-color:#2e3748;border-bottom-left-radius:0}.loading-message[_ngcontent-%COMP%]{min-width:60px;display:flex;justify-content:center}.loading-dots[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px}.dot[_ngcontent-%COMP%]{width:8px;height:8px;background-color:#a0aec0;border-radius:50%;animation:_ngcontent-%COMP%_bounce 1.4s infinite ease-in-out both}.dot[_ngcontent-%COMP%]:nth-child(1){animation-delay:-.32s}.dot[_ngcontent-%COMP%]:nth-child(2){animation-delay:-.16s}@keyframes _ngcontent-%COMP%_bounce{0%,80%,to{transform:scale(0)}40%{transform:scale(1)}}.input-container[_ngcontent-%COMP%]{padding:12px 16px;background-color:#282828;border-top:1px solid #333333}.input-form[_ngcontent-%COMP%]{display:flex}.message-input[_ngcontent-%COMP%]{flex:1;background-color:#434c5e;border:none;padding:12px 16px;border-radius:4px 0 0 4px;color:#fff;outline:none}.message-input[_ngcontent-%COMP%]::placeholder{color:#a0aec0}.message-input[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 2px #06b6d4}.send-button[_ngcontent-%COMP%]{padding:0 20px;background-color:#0bc5ea;border:none;border-radius:0 4px 4px 0;color:#fff;font-weight:500;cursor:pointer;transition:background-color .2s}.send-button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#0891b2}.send-button.button-disabled[_ngcontent-%COMP%]{background-color:#4a5568;cursor:not-allowed}"]})};export{Y as ChatComponent};
